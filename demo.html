<!DOCTYPE html>
<html>
  <head>
    <title>Chicago Overview</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <style>
      html, body, #map {
        height: 100%;
        width: 100%;
        padding: 0;
        margin: 0;
      }
      .text_over {
        z-index: 99;
        position: absolute;
        top: 70px;
        left: 600px;
        color: #444;
        background-color: rgba(250,250,250,0.8);
        font-size: 18px;
        line-height: 22px;
        font-family: arial;
        height: 600px;
        padding: 15px;
        width: 500px;
        overflow: scroll;
      }
      .text_over p {
        margin-bottom: 15px;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <div class="text_over">
      <h3>The plan</h3>
      <br><br><br>

      <h3>Gold line</h3>
      <p>The Gold Line is a brand new L line that connects the Loop to the South Side.</p>
      <p>Tired of waiting hours to get to Hyde Park or South Shore? Wait a few minutes.</p>
      <p>The Gold Line will run along existing railroad tracks, and connect Chicagoans to the 50,000 jobs around the University of Chicago.</p>
      <br><br><br>

      <h3>Ashland BRT</h3>
      <p>Bus Rapid Transit is like a subway on the street. Buses have their own lane, they have less frequent stops, and they can turn streetlights green - so they can speed through rush hour traffic.<p>
      <p>BRT on Ashland will run from the North Side to the Far South Side. You'll be able to zip from Lakeview to Wicker Park, from the West Loop to UIC, from Pilsen to Englewood - and beyond.</p>
      <h3></h3>
      <p>The route also runs by Whitney Young High School, Malcolm X College, and the University of Illinois at Chicago - now everyone can get to school.<p>
      <p>And it connects to major job centers - from West Loop lofts to Back of the Yards factories.</p>
      <br><br><br>

      <h3>Lime line</h3>
      <p>Like a west side Red Line, the Lime Line will run from the O'Hare Blue Line to Midway Airport--a speedy north-south route along Chicago's edge.</p>
      <h3></h3>
      <p>The route connects to the Blue, Green, Pink, and Orange Lines - making it easier for Westsiders to get to downtown jobs.</p>
      <h3></h3>
      <p>At Midway, the Lime Line heads east through south side transit deserts, linking up with the Red Line at 87th street.</p>
      <br><br><br>

      <h3>Orange line extension</h3>
      <p>A bit more orange means a lot more green. Extending the Orange Line to Ford City Mall and Richard J. Daley college means shops, jobs and classrooms are just an L stop away.</p>
      <br><br><br>

      <h3>Red line extension</h3>
      <p>Finally, rapid transit reaches Chicago's southern edge. The far South Side is now on the grid.</p>
      <p>The extension will slice commute times to the Loop, bringing economic opportunity to Roseland, Pullman, and Altgeld Gardens.</p>
      <br><br><br>

      <h3>Blue Line West - Forest Park to Oak Brook</h3>
      <b>PLACEHOLDERS START HERE</b>

      <p>The Blue line will be extended west from Forest Park to Oak Brook, creating a fast and convenient commute to one of the Chicagoland's biggest job centers.</b>
      <br><br><br>

      <b>Blue Line North - O'Hare to Schaumburg</b>
      <p>From airport to northwest burbs.</p>
      <p>Make it easier for NW commutes to get to jobs at O'hare, city people to get to jobs in Schaumburg</p>

      <h3>Your New Blue - O'Hare Branch improvements</h3>
      <p>The O'Hare branch of the blue line will get a major upgrade to track and stations from Grand to the airport.</p>
      <br><br><br>

      <br><br><br>

      <h3>Inner Circumferential</h3>

      <p>Connects O’Hare to Midway, with stops in west Cook County suburbs.</p>

      <p>Gives western Cook County a north-south connector that links into the rest of the network</p>

      <br><br><br>

      <h3>Brown line extension</h3>

      <p>Connect the North Side to O'Hare.</p>

      <p>You'll finally be able to make that flight on time.</p>

      <br><br><br>

      <h3>Red/Purple modernization</h3>

      <p>The People's Line is over a hundred years old.</p>

      <p>Rebuilding track from Lakeview to the end of the Purple Line will slice commutes time for the North Side</p>

      <br><br><br>

      <h3>Yellow line extension</h3>

      <p>Extends the Yellow line to Old Orchard Mall in Skokie.</p>
      <p>Now, everyone can get to work, study and shop at Old Orchard Mall and National Lewis University. And the north suburbs have a new connection to the rest of the region.</p>

      <br><br><br>

      <h3>Downtown Circulator</h3>

      <p>Stitches the Loop together, allowing commuters and tourists to zip from Union and Ogilvie Stations to Millennium Park, Streeterville and Navy Pier.</p>

      <br><br><br>

      <h3>West Loop Transportation Center</h3>

      <p>The region's new hub for transit, commuter rail, Amtrak and high-speed rail.</p>
      <p>Will let people switch from the L to Metra to Amtrak, and will someday serve as the major station for midwest high speed rail.</p>

      <br><br><br>

      <h3>Southeast Service</h3>

      <p>Commuter rail connecting the South Suburbs to jobs in the Loop and beyond.</p>

      <p>Will help rebuild suburban downtowns around new train stations — bringing economic growth and jobs to Dolton, Chicago Heights, and other South Suburban communities.</p>


      <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
      <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
      <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
    </div>

    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox.js/v0.6.7/mapbox.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox.js/v0.6.7/mapbox.css' rel='stylesheet' />

    <script>

// Define Modest Map of region with transit lines.
var map;
function main(){
  var basemap = mapbox.layer().id('mapmeld.map-x20zuxfw');
  map = mapbox.map('map', basemap, null, [ easey_handlers.DragHandler() ]);
  map.centerzoom({ lat: 41.853575, lon: -87.615443 }, 11);

    var map_data = {
      "version":"1.0.1",
      "stat_tag":"f1e3cbd2-a15f-11e3-8d43-0edbca4b5057",
      "layers":[
        {
          "type":"cartodb",
          "options":{
            "sql":"select * from transit_future_projects",
            "cartocss":"/** simple visualization */\n\n#transit_future_projects{\n  line-color: #FF6600;\n  line-width: 2;\n  line-opacity: 0.7;\n}",
            "cartocss_version":"2.1.1",
            "interactivity":["cartodb_id"]
          }
        },
        {
          "type":"cartodb",
          "options":{
            "sql":"select * from l_lines",
            "cartocss":"/** simple visualization */\n\n#l_lines{\n  line-color: #3e7bb6;\n  line-width: 2;\n  line-opacity: 0.7;\n}",
            "cartocss_version":"2.1.1",
            "interactivity":["cartodb_id"]
          }
        }
      ]
    };

    var s = document.createElement("script");
    s.type = "text/javascript";
    s.src = "http://jpvelez.cartodb.com/api/v1/map?"
      + "config=" + escape(JSON.stringify(map_data))
      + "&callback=loadedToken&t="
      + (new Date()) * 1;
    document.body.appendChild(s);
}

function loadedToken(tokenInfo){
  var token = tokenInfo.layergroupid;
  var template = new MM.Template('http://3.api.cartocdn.com/jpvelez/tiles/layergroup/' + token + '/{Z}/{X}/{Y}.png');
  var layer = new MM.Layer(template);
  map.addLayer(layer);
}

// Load map when window is done loading.
window.onload = main;


// Ease around the map as you scroll through the text.
// Define map views for each paragraph.
var current_view = 0;
var views = [
  null, // First paragraph stays on the initialization view.
  [41.79876395, -87.50411926, 12],  // Gold line
  [41.77177479, -87.53053094, 13],  // Gold line closeup
  [41.87876395, -87.61411926, 13],  // BRT
  [41.87876395, -87.65411926, 15],  // BRT closeup
  [41.86426600, -87.48822491, 11],  // Lime line
  [41.87648077,  -87.684650268, 13], // Lime line West side
  [41.79448077,  -87.692650268, 13],  // Lime line South side
  [41.77848077,  -87.719650268, 14],  // Orange line extension
  [41.69887172,  -87.624292373, 14],  // Red line extension
  [41.93747172,  -87.873292373, 12],  // Blue Line West - Forest Park to Oak Brook
  [41.88926600,  -87.733292373, 12],  // Blue Line fixes
  [41.88926600,  -87.733292373, 12],  // Inner Circumferential
  [41.92276600,  -87.790292373, 12],  // Brown Line extension
  [42.00440721,  -87.624933922, 13],  // Red/Purple Modernization
  [42.04387172,  -87.733292373, 14],  // Yellow line
  [41.88087172,  -87.628292373, 15],  // Downtown circulator
  // [41.88087172,  -87.628292373, 15],  // West Loop Transportation Center
  [41.66887172,  -87.624292373, 11],  // Southeast Service
];



// When you scroll..
$(".text_over").scroll(function(e){

  var paras = $(".text_over h3");

  // Loop through paragraphs
  for(var p=0;p<paras.length;p++){

    // Subtract distance between top of page and para from distance between top of page and text_over box.
    // Positive number means paragraph is below top edge of box, negative number means it's above.
    var top_offset = $(paras[p]).offset().top - $(".text_over").offset().top;

    // If paragraph is below top offset..
    if(top_offset >= 0){

      // select paragraph
      if(p == current_view){
        // view unchanged
        break;
      }

      current_view = p;
      if(views[current_view] === null){
        break;
      }

      // if current_view is a lat/lng bounds, calculate viewport
      // [south, west, north, east]
      if(views[current_view].length == 4){
        var lat_coefficient = 0.00051144938704069;
        var lng_coefficient = 0.00068664550781251;
        var zoom_coefficient = 11;
        var pixel_lng = (views[current_view][3] - views[current_view][1]) / lng_coefficient;
        var pixel_lat = (views[current_view][2] - views[current_view][0]) / lat_coefficient;

        views[current_view][0] = (views[current_view][0] + views[current_view][2]) / 2; // lat
        views[current_view][1] = (views[current_view][1] + views[current_view][3]) / 2; // lng
        views[current_view].pop();

        // explaining the math:
        // pixels_at_zoom_11 = SCREEN_DIMENSION_TO_STRETCH / DEGREE_PER_PIXEL
        // multiply_scale_by = (AVAILABLE_PIXELS / pixels_at_zoom_11)
        // zoom_delta = log(multiply_scale_by) / log(2) because width is 2^zoom

        if(pixel_lng / pixel_lat > $("#map").width() / $("#map").height()){
          // we're going to squeeze until the width fits
          views[current_view][2] = 11 - Math.ceil( Math.log( Math.round(pixel_lng / $("#map").width()) ) / Math.log(2) );
        }
        else{
          // we're going to squeeze until the height fits
          views[current_view][2] = 11 - Math.ceil( Math.log( Math.round(pixel_lat / $("#map").height()) ) / Math.log(2) );
        }

        console.log(views[current_view]);
      }

      // Ease to lat/lon/z view of current paragraph - the first p element
      // below the top edge of the box. This gets called the instant the previous
      // element's offset becomes negative.
      map.ease.location({
        lat: views[current_view][0],
        lon: views[current_view][1]
      }).zoom(views[current_view][2]).optimal();

      break;
    }
  }
});
    </script>
  </body>
</html>

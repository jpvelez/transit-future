<!DOCTYPE html>
<html>
  <head>
    <title>Chicago Overview</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <style>
      html, body, #map {
        height: 100%;
        width: 100%;
        padding: 0;
        margin: 0;
      }
      .text_over {
        z-index: 99;
        position: absolute;
        top: 70px;
        left: 20px;
        color: #444;
        background-color: rgba(250,250,250,0.8);
        font-size: 18px;
        line-height: 22px;
        font-family: arial;
        height: 300px;
        padding: 15px;
        width: 200px;
        overflow: scroll;
      }
      .text_over p {
        margin-bottom: 15px;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <div class="text_over">
      <p>The plan</p>
      <br><br><br>
      <p>Gold line</p>
      <br><br><br>
      <p class="prepara">Ashland BRT</p>
      <br><br><br>
      <p class="midpara">Lime line</p>
      <br><br><br>
      <p class="endpara">Orange line extension</p>
      <br><br><br>
      <p>Red line extension</p>
      <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
    </div>

    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox.js/v0.6.7/mapbox.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox.js/v0.6.7/mapbox.css' rel='stylesheet' />

    <script>

// Define Modest Map of region with transit lines.
var map;
function main(){
  var basemap = mapbox.layer().id('mapmeld.map-x20zuxfw');
  map = mapbox.map('map', basemap, null, [ easey_handlers.DragHandler() ]);
  map.centerzoom({ lat: 41.853575, lon: -87.735443 }, 11);

    var s = document.createElement("script");
    s.type = "text/javascript";
    s.src = "http://jpvelez.cartodb.com/tiles/layergroup?config=%7B%22version%22%3A%221.0.1%22%2C%22stat_tag%22%3A%2274b8ee36-96a5-11e3-891c-0edd25b1ac90%22%2C%22layers%22%3A%5B%7B%22type%22%3A%22cartodb%22%2C%22options%22%3A%7B%22sql%22%3A%22SELECT%20*%20%5CnFROM%20cmap_capital_projects%5CnWHERE%20cartodb_id%3D5%5CnOR%20cartodb_id%3D7%5CnOR%20cartodb_id%3D11%5CnOR%20cartodb_id%3D12%5CnOR%20cartodb_id%3D19%5CnOR%20cartodb_id%3D20%5CnOR%20cartodb_id%3D21%5CnOR%20cartodb_id%3D27%5CnOR%20cartodb_id%3D31%5CnOR%20cartodb_id%3D35%5Cn%5Cn%22%2C%22cartocss%22%3A%22%2F**%20simple%20visualization%20*%2F%5Cn%5Cn%23cmap_capital_projects%7B%5Cn%20%20line-color%3A%20%23F11810%3B%5Cn%20%20line-width%3A%203%3B%5Cn%20%20line-opacity%3A%200.7%3B%5Cn%7D%22%2C%22cartocss_version%22%3A%222.1.1%22%2C%22interactivity%22%3A%5B%22cartodb_id%22%5D%7D%7D%2C%7B%22type%22%3A%22cartodb%22%2C%22options%22%3A%7B%22sql%22%3A%22SELECT%20*%20%5CnFROM%20metra_lines%5CnWHERE%20NOT%20cartodb_id%3D208%22%2C%22cartocss%22%3A%22%2F**%20simple%20visualization%20*%2F%5Cn%5Cn%23metra_lines%7B%5Cn%20%20line-color%3A%20%23A53ED5%3B%5Cn%20%20line-width%3A%203%3B%5Cn%20%20line-opacity%3A%200.7%3B%5Cn%7D%22%2C%22cartocss_version%22%3A%222.1.1%22%2C%22interactivity%22%3A%5B%22cartodb_id%22%5D%7D%7D%2C%7B%22type%22%3A%22cartodb%22%2C%22options%22%3A%7B%22sql%22%3A%22select%20*%20from%20l_lines%22%2C%22cartocss%22%3A%22%2F**%20simple%20visualization%20*%2F%5Cn%5Cn%23l_lines%7B%5Cn%20%20line-color%3A%20%23229A00%3B%5Cn%20%20line-width%3A%203%3B%5Cn%20%20line-opacity%3A%200.7%3B%5Cn%7D%22%2C%22cartocss_version%22%3A%222.1.1%22%2C%22interactivity%22%3A%5B%22cartodb_id%22%5D%7D%7D%2C%7B%22type%22%3A%22cartodb%22%2C%22options%22%3A%7B%22sql%22%3A%22select%20*%20from%20brt_phase1%22%2C%22cartocss%22%3A%22%2F**%20simple%20visualization%20*%2F%5Cn%5Cn%23brt_phase1%7B%5Cn%20%20line-color%3A%20%23f11810%3B%5Cn%20%20line-width%3A%203%3B%5Cn%20%20line-opacity%3A%200.7%3B%5Cn%7D%22%2C%22cartocss_version%22%3A%222.1.1%22%2C%22interactivity%22%3A%5B%22cartodb_id%22%5D%7D%7D%5D%7D&callback=loadedToken&t="
      + (new Date()) * 1;
    document.body.appendChild(s);
}

function loadedToken(tokenInfo){
  var token = tokenInfo.layergroupid;
  var template = new MM.Template('http://3.api.cartocdn.com/jpvelez/tiles/layergroup/' + token + '/{Z}/{X}/{Y}.png');
  var layer = new MM.Layer(template);
  map.addLayer(layer);
}

// Load map when window is done loading.
window.onload = main;


// Ease around the map as you scroll through the text.
// Define map views for each paragraph.
var current_view = 0;
var views = [
  null, // First paragraph stays on the initialization view.
  [41.80177479, -87.58953094, 13],  // View for second paragraph..
  [41.87876395, -87.64411926, 13],
  [41.89026600, -87.78522491, 12],
  [41.77848077,  -87.719650268, 14],
  [41.69887172,  -87.624292373, 14]
];

// When you scroll..
$(".text_over").scroll(function(e){
  
  var paras = $(".text_over p");

  // Loop through paragraphs
  for(var p=0;p<paras.length;p++){

    // Subtract distance between top of page and para from distance between top of page and text_over box.
    // Positive number means paragraph is below top edge of box, negative number means it's above.
    var top_offset = $(paras[p]).offset().top - $(".text_over").offset().top;

    // If paragraph is below top offset..
    if(top_offset >= 0){

      // select paragraph
      if(p == current_view){
        // view unchanged
        break;
      }

      current_view = p;
      if(views[current_view] === null){
        break;
      }

      // Ease to lat/lon/z view of current paragraph - the first p element
      // below the top edge of the box. This gets called the instant the previous
      // element's offset becomes negative.
      map.ease.location({
        lat: views[current_view][0],
        lon: views[current_view][1]
      }).zoom(views[current_view][2]).optimal();

      break;
    }
  }
});
    </script>
  </body>
</html>